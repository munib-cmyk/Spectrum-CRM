<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Spectrum CRM — Admin Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta content="Admin: CSV import/export, pricing editor, backups" name="description" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="icon" href="data:,">
  <link href="plugins/jvectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet">
  <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/css/jquery-ui.min.css" rel="stylesheet" />
  <link href="assets/css/icons.min.css" rel="stylesheet" />
  <link href="assets/css/metisMenu.min.css" rel="stylesheet" />
  <link href="assets/css/app.min.css" rel="stylesheet" />
  <style>
    .card h5{margin-bottom:.5rem}
    .help{color:#6b7280;font-size:12px}
    .monospace{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
    .pill{display:inline-block;padding:.15rem .5rem;border-radius:9999px;background:#eef2f7;font-size:12px}
    .w-260{width:260px}
  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="topbar-left">
      <a href="index.html" class="logo">
        <span><img src="assets/images/logo-sm.png" class="logo-sm" alt=""></span>
        <span><img src="assets/images/logo.png" class="logo-lg logo-light" alt=""><img src="assets/images/logo-dark.png" class="logo-lg" alt=""></span>
      </a>
    </div>
    <nav class="navbar-custom">
      <ul class="list-unstyled topbar-nav float-right mb-0">
        <li class="dropdown">
          <a class="nav-link dropdown-toggle nav-user" data-toggle="dropdown" href="#"><img src="assets/images/users/user-1.png" class="rounded-circle" alt=""> <span class="ml-1 nav-user-name hidden-sm">Admin</span></a>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="#"><i class="ti-settings text-muted mr-2"></i> Settings</a>
            <div class="dropdown-divider mb-0"></div>
            <a class="dropdown-item" href="#"><i class="ti-power-off text-muted mr-2"></i> Logout</a>
          </div>
        </li>
      </ul>
      <ul class="list-unstyled topbar-nav mb-0">
        <li><button class="nav-link button-menu-mobile"><i class="ti-menu nav-icon"></i></button></li>
      </ul>
    </nav>
  </div>

  <!-- Sidebar (UNIFIED — copy this block to all pages) -->
  <div class="left-sidenav">
    <ul class="metismenu left-sidenav-menu">
      <li>
        <a href="javascript:void(0);"><i class="ti-bar-chart"></i><span>Dashboard</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="crm.html"><i class="ti-control-record"></i>CRM</a></li>
          <li class="nav-item"><a class="nav-link" href="analytics.html"><i class="ti-control-record"></i>Analytics</a></li>
          <li class="nav-item"><a class="nav-link" href="helpdesk.html"><i class="ti-control-record"></i>Helpdesk</a></li>
          <li class="nav-item"><a class="nav-link" href="sales.html"><i class="ti-control-record"></i>Sales (Admin)</a></li>
        </ul>
      </li>
      <li>
        <a href="javascript:void(0);"><i class="ti-layers-alt"></i><span>Medspa Dashboards</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="marketing.html"><i class="ti-control-record"></i>Marketing</a></li>
          <li class="nav-item"><a class="nav-link" href="financial.html"><i class="ti-control-record"></i>Financial</a></li>
          <li class="nav-item"><a class="nav-link" href="operations.html"><i class="ti-control-record"></i>Operations</a></li>
        </ul>
      </li>
      <li>
        <a href="javascript:void(0);"><i class="ti-user"></i><span>Pipeline</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="leads.html"><i class="ti-control-record"></i>Leads</a></li>
          <li class="nav-item"><a class="nav-link" href="followups.html"><i class="ti-control-record"></i>Follow-ups</a></li>
          <li class="nav-item"><a class="nav-link" href="rebooking.html"><i class="ti-control-record"></i>Rebookings</a></li>
        </ul>
      </li>
      <li>
        <a href="javascript:void(0);"><i class="ti-package"></i><span>Apps</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="app-email.html"><i class="ti-control-record"></i>Email (Google)</a></li>
          <li class="nav-item"><a class="nav-link" href="app-chat.html"><i class="ti-control-record"></i>Chat (Google)</a></li>
          <li class="nav-item"><a class="nav-link" href="app-contacts.html"><i class="ti-control-record"></i>Contact List</a></li>
          <li class="nav-item"><a class="nav-link" href="app-calendar.html"><i class="ti-control-record"></i>Calendar (Google)</a></li>
          <li class="nav-item"><a class="nav-link" href="quotes.html"><i class="ti-control-record"></i>Treatment Quotes</a></li>
        </ul>
      </li>
      <li>
        <a href="projects.html"><i class="ti-layout"></i><span>Projects — Publer</span></a>
      </li>
      <li>
        <a href="javascript:void(0);"><i class="ti-agenda"></i><span>Pages</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="vendors.html"><i class="ti-control-record"></i>Vendors & Purchasing</a></li>
          <li class="nav-item"><a class="nav-link" href="inventory.html"><i class="ti-control-record"></i>Inventory</a></li>
          <li class="nav-item"><a class="nav-link" href="pricing.html"><i class="ti-control-record"></i>Pricing</a></li>
          <li class="nav-item"><a class="nav-link" href="gallery.html"><i class="ti-control-record"></i>Gallery</a></li>
        </ul>
      </li>
      <li class="mm-active">
        <a href="javascript:void(0);"><i class="ti-settings"></i><span>Admin</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level mm-show">
          <li class="nav-item"><a class="nav-link active" href="admin.html"><i class="ti-control-record"></i>Admin Console</a></li>
          <li class="nav-item"><a class="nav-link" href="admin-reports.html"><i class="ti-control-record"></i>Reports Hub</a></li>
        </ul>
      </li>
    </ul>
  </div>

  <div class="page-wrapper">
    <div class="page-content">
      <div class="container-fluid">
        <!-- Title -->
        <div class="row">
          <div class="col-sm-12">
            <div class="page-title-box">
              <div class="float-right">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="#">Admin</a></li>
                  <li class="breadcrumb-item active">Console</li>
                </ol>
              </div>
              <h4 class="page-title">Admin Console</h4>
            </div>
          </div>
        </div>

        <!-- CSV Imports -->
        <div class="row">
          <div class="col-xl-6">
            <div class="card">
              <div class="card-body">
                <h5>CSV Import</h5>
                <p class="help">Import CSV into localStorage keys used by modules. Headers auto-detected.</p>
                <div class="form-inline mb-2">
                  <label class="mr-2">Target</label>
                  <select id="csvTarget" class="form-control mr-3 w-260">
                    <option value="ssc_crm_leads">Leads (ssc_crm_leads)</option>
                    <option value="ssc_crm_followups">Follow-ups (ssc_crm_followups)</option>
                    <option value="ssc_crm_rebookings">Rebookings (ssc_crm_rebookings)</option>
                    <option value="ssc_pricing">Pricing (ssc_pricing)</option>
                    <option value="ssc_inventory">Inventory (ssc_inventory)</option>
                    <option value="ssc_vendors">Vendors (ssc_vendors)</option>
                  </select>
                  <input id="csvFile" type="file" accept=".csv" class="form-control-file mr-2">
                  <button id="btnImport" class="btn btn-gradient-primary">Import</button>
                </div>
                <div id="csvStatus" class="help monospace"></div>
              </div>
            </div>
          </div>

          <!-- Export / Backup -->
          <div class="col-xl-6">
            <div class="card">
              <div class="card-body">
                <h5>Export / Backup</h5>
                <p class="help">Download CSV snapshots of your current data.</p>
                <div class="d-flex flex-wrap" style="gap:8px">
                  <button class="btn btn-soft-primary" data-export="ssc_crm_leads">Export Leads</button>
                  <button class="btn btn-soft-primary" data-export="ssc_crm_followups">Export Follow-ups</button>
                  <button class="btn btn-soft-primary" data-export="ssc_crm_rebookings">Export Rebookings</button>
                  <button class="btn btn-soft-secondary" data-export="ssc_pricing">Export Pricing</button>
                  <button class="btn btn-soft-secondary" data-export="ssc_inventory">Export Inventory</button>
                  <button class="btn btn-soft-secondary" data-export="ssc_vendors">Export Vendors</button>
                </div>
                <div class="help mt-2">Files download as <span class="monospace">KEY_YYYY-MM-DD.csv</span></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pricing Editor Shell -->
        <div class="row">
          <div class="col-xl-12">
            <div class="card">
              <div class="card-body">
                <h5>Pricing Editor</h5>
                <p class="help">Lightweight inline editor backed by <span class="monospace">localStorage["ssc_pricing"]</span>.</p>

                <div class="table-responsive">
                  <table class="table table-bordered" id="tblPricing">
                    <thead class="thead-light">
                      <tr>
                        <th>Category</th>
                        <th>Service</th>
                        <th>Price</th>
                        <th>SKU</th>
                        <th>Notes</th>
                        <th style="width:120px">Actions</th>
                      </tr>
                    </thead>
                    <tbody><!-- filled by JS --></tbody>
                  </table>
                </div>
                <button id="btnAddRow" class="btn btn-primary">Add Row</button>
                <button id="btnSavePricing" class="btn btn-success">Save Pricing</button>
                <span id="pricingStatus" class="help ml-2"></span>
              </div>
            </div>
          </div>
        </div>

      </div>
      <footer class="footer text-center text-sm-left">&copy; 2025 Spectrum CRM</footer>
    </div>
  </div>

  <!-- Core JS -->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/metismenu.min.js"></script>
  <script src="assets/js/waves.js"></script>
  <script src="assets/js/feather.min.js"></script>
  <script src="assets/js/jquery.slimscroll.min.js"></script>
  <script src="assets/js/jquery-ui.min.js"></script>

  <!-- Admin CSV Engine -->
  <script src="assets/js/admin-csv.js"></script>

  <!-- App (keeps layout working) -->
  <script src="assets/js/app.js"></script>

  <script>
    // ------- Pricing Editor wiring -------
    const PRICING_KEY = 'ssc_pricing';
    function readJSON(key){ try{ return JSON.parse(localStorage.getItem(key)||'[]'); }catch(_){ return []; } }
    function writeJSON(key,val){ try{ localStorage.setItem(key, JSON.stringify(val)); }catch(_){ } }

    function rowHTML(item={}, idx=null){
      return `<tr data-idx="${idx??''}">
        <td contenteditable="true">${item.category||''}</td>
        <td contenteditable="true">${item.service||''}</td>
        <td contenteditable="true">${item.price||''}</td>
        <td contenteditable="true">${item.sku||''}</td>
        <td contenteditable="true">${item.notes||''}</td>
        <td>
          <button class="btn btn-sm btn-soft-danger btnDel">Delete</button>
        </td>
      </tr>`;
    }

    function renderPricing(){
      const data = readJSON(PRICING_KEY);
      $('#tblPricing tbody').html(data.map((it,i)=>rowHTML(it,i)).join('') || `<tr><td colspan="6" class="text-muted">No pricing yet. Import CSV or add rows.</td></tr>`);
    }

    $(function(){
      renderPricing();

      $('#btnAddRow').on('click', ()=>{
        $('#tblPricing tbody').append(rowHTML());
      });

      $('#tblPricing').on('click', '.btnDel', function(){
        $(this).closest('tr').remove();
      });

      $('#btnSavePricing').on('click', ()=>{
        const rows = Array.from(document.querySelectorAll('#tblPricing tbody tr')).map(tr=>{
          const tds = tr.querySelectorAll('td');
          return {
            category: tds[0].innerText.trim(),
            service: tds[1].innerText.trim(),
            price: tds[2].innerText.trim(),
            sku: tds[3].innerText.trim(),
            notes: tds[4].innerText.trim(),
          };
        }).filter(x=>x.category || x.service);
        writeJSON(PRICING_KEY, rows);
        $('#pricingStatus').text('Saved ✓');
        setTimeout(()=>$('#pricingStatus').text(''), 1500);
      });

      // CSV buttons
      $('[data-export]').on('click', function(){ exportCsv($(this).data('export')); });
      $('#btnImport').on('click', ()=> importCsv($('#csvTarget').val(), document.getElementById('csvFile'), document.getElementById('csvStatus')));
    });
  </script>
</body>
</html>