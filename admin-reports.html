<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Spectrum CRM — Reports Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta content="Central reports hub" name="description" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="icon" href="data:,">
  <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/css/jquery-ui.min.css" rel="stylesheet" />
  <link href="assets/css/icons.min.css" rel="stylesheet" />
  <link href="assets/css/metisMenu.min.css" rel="stylesheet" />
  <link href="assets/css/app.min.css" rel="stylesheet" />
  <style>.card h5{margin:0 0 .5rem}.report-card{cursor:pointer}</style>
</head>
<body>

<script>
  firebase.auth().onAuthStateChanged(async (user) => {
    if (!user) {
      window.location.href = "login.html"; 
      return;
    }
    const doc = await firebase.firestore().collection("users").doc(user.uid).get();
    const role = doc.exists ? doc.data().role : "frontdesk";
    window.currentRole = role;
    const path = window.location.pathname.split("/").pop();
    const adminOnly = ["admin.html"];
    const marketingOnly = ["marketing.html","projects.html","gallery.html"];
    if (adminOnly.includes(path) <body><body> role !== "admin") window.location.href="unauthorized.html";
    if (marketingOnly.includes(path) <body><body> role==="frontdesk") window.location.href="unauthorized.html";
  });
</script>
  <!-- Topbar -->
  <div class="topbar">
    <div class="topbar-left"><a href="index.html" class="logo"><span><img src="assets/images/logo-sm.png" class="logo-sm" alt=""></span><span><img src="assets/images/logo.png" class="logo-lg logo-light" alt=""><img src="assets/images/logo-dark.png" class="logo-lg" alt=""></span></a></div>
    <nav class="navbar-custom"><ul class="list-unstyled topbar-nav mb-0"><li><button class="nav-link button-menu-mobile"><i class="ti-menu nav-icon"></i></button></li></ul></nav>
  </div>

  <!-- Sidebar (UNIFIED — same as admin.html) -->
  <div class="left-sidenav">
    <ul class="metismenu left-sidenav-menu">
      <li>
        <a href="javascript:void(0);"><i class="ti-bar-chart"></i><span>Dashboard</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="crm.html"><i class="ti-control-record"></i>CRM</a></li>
          <li class="nav-item"><a class="nav-link" href="analytics.html"><i class="ti-control-record"></i>Analytics</a></li>
          <li class="nav-item"><a class="nav-link" href="helpdesk.html"><i class="ti-control-record"></i>Helpdesk</a></li>
          <li class="nav-item"><a class="nav-link" href="sales.html"><i class="ti-control-record"></i>Sales (Admin)</a></li>
        </ul>
      </li>
      <li>
        <a href="javascript:void(0);"><i class="ti-layers-alt"></i><span>Medspa Dashboards</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="marketing.html"><i class="ti-control-record"></i>Marketing</a></li>
          <li class="nav-item"><a class="nav-link" href="financial.html"><i class="ti-control-record"></i>Financial</a></li>
          <li class="nav-item"><a class="nav-link" href="operations.html"><i class="ti-control-record"></i>Operations</a></li>
        </ul>
      </li>
      <li>
        <a href="javascript:void(0);"><i class="ti-user"></i><span>Pipeline</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="leads.html"><i class="ti-control-record"></i>Leads</a></li>
          <li class="nav-item"><a class="nav-link" href="followups.html"><i class="ti-control-record"></i>Follow-ups</a></li>
          <li class="nav-item"><a class="nav-link" href="rebooking.html"><i class="ti-control-record"></i>Rebookings</a></li>
        </ul>
      </li>
      <li>
        <a href="javascript:void(0);"><i class="ti-package"></i><span>Apps</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="app-email.html"><i class="ti-control-record"></i>Email (Google)</a></li>
          <li class="nav-item"><a class="nav-link" href="app-chat.html"><i class="ti-control-record"></i>Chat (Google)</a></li>
          <li class="nav-item"><a class="nav-link" href="app-contacts.html"><i class="ti-control-record"></i>Contact List</a></li>
          <li class="nav-item"><a class="nav-link" href="app-calendar.html"><i class="ti-control-record"></i>Calendar (Google)</a></li>
          <li class="nav-item"><a class="nav-link" href="quotes.html"><i class="ti-control-record"></i>Treatment Quotes</a></li>
        </ul>
      </li>
      <li>
        <a href="projects.html"><i class="ti-layout"></i><span>Projects — Publer</span></a>
      </li>
      <li>
        <a href="javascript:void(0);"><i class="ti-agenda"></i><span>Pages</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level">
          <li class="nav-item"><a class="nav-link" href="vendors.html"><i class="ti-control-record"></i>Vendors & Purchasing</a></li>
          <li class="nav-item"><a class="nav-link" href="inventory.html"><i class="ti-control-record"></i>Inventory</a></li>
          <li class="nav-item"><a class="nav-link" href="pricing.html"><i class="ti-control-record"></i>Pricing</a></li>
          <li class="nav-item"><a class="nav-link" href="gallery.html"><i class="ti-control-record"></i>Gallery</a></li>
        </ul>
      </li>
      <li class="mm-active">
        <a href="javascript:void(0);"><i class="ti-settings"></i><span>Admin</span><span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
        <ul class="nav-second-level mm-show">
          <li class="nav-item"><a class="nav-link" href="admin.html"><i class="ti-control-record"></i>Admin Console</a></li>
          <li class="nav-item"><a class="nav-link active" href="admin-reports.html"><i class="ti-control-record"></i>Reports Hub</a></li>
        </ul>
      </li>
    </ul>
  </div>

  <div class="page-wrapper">
    <div class="page-content">
      <div class="container-fluid">
        <div class="row"><div class="col-sm-12"><div class="page-title-box"><h4 class="page-title">Reports Hub</h4></div></div></div>
        <div class="row">
          <div class="col-md-4">
            <div class="card report-card" onclick="location.href='sales.html'"><div class="card-body"><h5>Sales Report</h5><p class="mb-0 text-muted">Revenue by month, by service, Rev/Patient.</p></div></div>
          </div>
          <div class="col-md-4">
            <div class="card report-card" onclick="location.href='marketing.html'"><div class="card-body"><h5>Marketing Report</h5><p class="mb-0 text-muted">Leads by source, funnel conversion.</p></div></div>
          </div>
          <div class="col-md-4">
            <div class="card report-card" onclick="location.href='operations.html'"><div class="card-body"><h5>Operations Report</h5><p class="mb-0 text-muted">Utilization, inventory burn, load.</p></div></div>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <h5 class="mb-3">Quick Snapshot (from localStorage data)</h5>
            <div class="table-responsive">
              <table class="table table-bordered mb-0">
                <thead class="thead-light"><tr><th>Metric</th><th>Value</th></tr></thead>
                <tbody id="tMetrics"><tr><td colspan="2" class="text-muted">No data yet. Import CSV in Admin Console.</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
      <footer class="footer text-center text-sm-left">&copy; 2025 Spectrum CRM</footer>
    </div>
  </div>

  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/metismenu.min.js"></script>
  <script src="assets/js/waves.js"></script>
  <script src="assets/js/feather.min.js"></script>
  <script src="assets/js/jquery.slimscroll.min.js"></script>
  <script src="assets/js/jquery-ui.min.js"></script>
  <script src="assets/js/app.js"></script>
  <script>
    function r(key){ try{return JSON.parse(localStorage.getItem(key)||'[]')}catch(_){return []} }
    function sum(arr, f){ return arr.reduce((a,x)=>a+(+f(x)||0),0) }
    $(function(){
      const leads = r('ssc_crm_leads');
      const pricing = r('ssc_pricing');
      const followups = r('ssc_crm_followups');
      const inventory = r('ssc_inventory');
      const vendors = r('ssc_vendors');
      
      const metrics = [
        ['Total Leads', leads.length],
        ['Total Follow-ups', followups.length], 
        ['Pricing Items', pricing.length],
        ['Inventory Items', inventory.length],
        ['Vendors', vendors.length],
        ['Avg Lead Value', leads.length ? '$' + (sum(leads, x=>x.value)/leads.length).toFixed(2) : '$0'],
        ['Total Pipeline Value', '$' + sum(leads, x=>x.value).toFixed(2)]
      ];
      
      if(metrics.some(m=>m[1]>0)){
        $('#tMetrics').html(metrics.map(([k,v])=>`<tr><td>${k}</td><td><strong>${v}</strong></td></tr>`).join(''));
      }
    });
  </script>
  <script type="module" src="assets/js/firebase-config.js"></script>
</body>
</html>
