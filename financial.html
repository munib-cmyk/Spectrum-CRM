<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Spectrum CRM — Financial Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta content="Financial KPIs and costs" name="description" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="icon" href="data:,">
  <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/css/jquery-ui.min.css" rel="stylesheet" />
  <link href="assets/css/icons.min.css" rel="stylesheet" />
  <link href="assets/css/metisMenu.min.css" rel="stylesheet" />
  <link href="assets/css/app.min.css" rel="stylesheet" />
</head>
<body>

<script>
  firebase.auth().onAuthStateChanged(async (user) => {
    if (!user) {
      window.location.href = "login.html"; 
      return;
    }
    const doc = await firebase.firestore().collection("users").doc(user.uid).get();
    const role = doc.exists ? doc.data().role : "frontdesk";
    window.currentRole = role;
    const path = window.location.pathname.split("/").pop();
    const adminOnly = ["admin.html"];
    const marketingOnly = ["marketing.html","projects.html","gallery.html"];
    if (adminOnly.includes(path) <body><body> role !== "admin") window.location.href="unauthorized.html";
    if (marketingOnly.includes(path) <body><body> role==="frontdesk") window.location.href="unauthorized.html";
  });
</script>
  <div class="topbar">
    <div class="topbar-left">
      <a href="index.html" class="logo">
        <span><img src="assets/images/logo-sm.png" class="logo-sm" alt=""></span>
        <span><img src="assets/images/logo.png" class="logo-lg logo-light" alt=""><img src="assets/images/logo-dark.png" class="logo-lg" alt=""></span>
      </a>
    </div>
    <nav class="navbar-custom">
      <ul class="list-unstyled topbar-nav mb-0">
        <li><button class="nav-link button-menu-mobile"><i class="ti-menu nav-icon"></i></button></li>
      </ul>
    </nav>
  </div>

<div class="left-sidenav">
  <ul class="metismenu left-sidenav-menu">

    <!-- Dashboards -->
    <li>
      <a href="javascript:void(0);">
        <i class="ti-bar-chart"></i><span>Dashboard</span>
        <span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span>
      </a>
      <ul class="nav-second-level" aria-expanded="false">
        <li class="nav-item"><a class="nav-link" href="crm.html"><i class="ti-control-record"></i>CRM</a></li>
        <li class="nav-item"><a class="nav-link" href="analytics.html"><i class="ti-control-record"></i>Analytics</a></li>
        <li class="nav-item"><a class="nav-link" href="helpdesk.html"><i class="ti-control-record"></i>Helpdesk</a></li>
        <li class="nav-item"><a class="nav-link" href="sales.html"><i class="ti-control-record"></i>Sales (Admin)</a></li>
      </ul>
    </li>

    <!-- Medspa Dashboards -->
    <li>
      <a href="javascript:void(0);">
        <i class="ti-layers-alt"></i><span>Medspa Dashboards</span>
        <span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span>
      </a>
      <ul class="nav-second-level" aria-expanded="false">
        <li class="nav-item"><a class="nav-link" href="marketing.html"><i class="ti-control-record"></i>Marketing</a></li>
        <li class="nav-item"><a class="nav-link" href="financial.html"><i class="ti-control-record"></i>Financial</a></li>
        <li class="nav-item"><a class="nav-link" href="operations.html"><i class="ti-control-record"></i>Operations</a></li>
      </ul>
    </li>

    <!-- Pipeline -->
    <li>
      <a href="javascript:void(0);">
        <i class="ti-user"></i><span>Pipeline</span>
        <span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span>
      </a>
      <ul class="nav-second-level" aria-expanded="false">
        <li class="nav-item"><a class="nav-link" href="leads.html"><i class="ti-control-record"></i>Leads</a></li>
        <li class="nav-item"><a class="nav-link" href="followups.html"><i class="ti-control-record"></i>Follow-ups</a></li>
        <li class="nav-item"><a class="nav-link" href="rebooking.html"><i class="ti-control-record"></i>Rebookings</a></li>
      </ul>
    </li>

    <!-- Apps -->
    <li>
      <a href="javascript:void(0);">
        <i class="ti-package"></i><span>Apps</span>
        <span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span>
      </a>
      <ul class="nav-second-level" aria-expanded="false">
        <li class="nav-item"><a class="nav-link" href="app-email.html"><i class="ti-control-record"></i>Email (Google)</a></li>
        <li class="nav-item"><a class="nav-link" href="app-chat.html"><i class="ti-control-record"></i>Chat (Google)</a></li>
        <li class="nav-item"><a class="nav-link" href="app-contacts.html"><i class="ti-control-record"></i>Contact List</a></li>
        <li class="nav-item"><a class="nav-link" href="app-calendar.html"><i class="ti-control-record"></i>Calendar (Google)</a></li>
        <li class="nav-item"><a class="nav-link" href="quotes.html"><i class="ti-control-record"></i>Treatment Quotes</a></li>
      </ul>
    </li>

    <!-- Projects -->
    <li>
      <a href="javascript:void(0);">
        <i class="ti-pencil-alt"></i><span>Projects</span>
        <span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span>
      </a>
      <ul class="nav-second-level" aria-expanded="false">
        <li class="nav-item"><a class="nav-link" href="projects.html"><i class="ti-control-record"></i>Publer-style Publishing</a></li>
      </ul>
    </li>

    <!-- Admin -->
    <li>
      <a href="javascript:void(0);"><i class="ti-settings"></i><span>Admin</span>
        <span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span></a>
      <ul class="nav-second-level" aria-expanded="false">
        <li class="nav-item"><a class="nav-link" href="admin.html"><i class="ti-control-record"></i>Admin Console</a></li>
      </ul>
    </li>

    <!-- Pages -->
    <li>
      <a href="javascript:void(0);">
        <i class="ti-agenda"></i><span>Pages</span>
        <span class="menu-arrow"><i class="mdi mdi-chevron-right"></i></span>
      </a>
      <ul class="nav-second-level" aria-expanded="false">
        <li class="nav-item"><a class="nav-link" href="vendors.html"><i class="ti-control-record"></i>Vendor Mgmt & Purchasing</a></li>
        <li class="nav-item"><a class="nav-link" href="inventory.html"><i class="ti-control-record"></i>Inventory</a></li>
        <li class="nav-item"><a class="nav-link" href="pricing.html"><i class="ti-control-record"></i>Pricing</a></li>
        <li class="nav-item"><a class="nav-link" href="gallery.html"><i class="ti-control-record"></i>Gallery</a></li>
      </ul>
    </li>

  </ul>
</div>

  <div class="page-wrapper">
    <div class="page-content">
      <div class="container-fluid">

        <div class="row">
          <div class="col-sm-12">
            <div class="page-title-box">
              <h4 class="page-title">Financial Dashboard</h4>
            </div>
          </div>
        </div>

        <!-- KPIs -->
        <div class="row">
          <div class="col-md-3"><div class="card crm-data-card"><div class="card-body"><p class="text-muted mb-1">Monthly Revenue</p><h3 id="fin_mrev">—</h3></div></div></div>
          <div class="col-md-3"><div class="card crm-data-card"><div class="card-body"><p class="text-muted mb-1">Rev / Patient</p><h3 id="fin_rpp">—</h3></div></div></div>
          <div class="col-md-3"><div class="card crm-data-card"><div class="card-body"><p class="text-muted mb-1">COGS %</p><h3 id="fin_cogs">—</h3></div></div></div>
          <div class="col-md-3"><div class="card crm-data-card"><div class="card-body"><p class="text-muted mb-1">Gross Margin</p><h3 id="fin_gm">—</h3></div></div></div>
        </div>

        <!-- Charts -->
        <div class="row">
          <div class="col-lg-8">
            <div class="card"><div class="card-body">
              <h4 class="header-title mt-0 mb-3">Revenue (12 mo)</h4>
              <div id="fin_rev_line" class="apex-charts"></div>
            </div></div>
          </div>
          <div class="col-lg-4">
            <div class="card"><div class="card-body">
              <h4 class="header-title mt-0 mb-3">Expense Mix</h4>
              <div id="fin_expense_pie" class="apex-charts"></div>
            </div></div>
          </div>
        </div>

        <div class="card"><div class="card-body">
          <h4 class="header-title mt-0 mb-3">Costs (Stacked)</h4>
          <div id="fin_costs_stacked" class="apex-charts"></div>
        </div></div>

      </div>
      <footer class="footer text-center text-sm-left">
        &copy; 2020 Crovex <span class="text-muted d-none d-sm-inline-block float-right">Mannatthemes</span>
      </footer>
    </div>
  </div>

  <!-- Core JS -->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/metismenu.min.js"></script>
  <script src="assets/js/waves.js"></script>
  <script src="assets/js/feather.min.js"></script>
  <script src="assets/js/jquery.slimscroll.min.js"></script>
  <script src="assets/js/jquery-ui.min.js"></script>

  <!-- Plugins -->
  <script src="plugins/moment/moment.js"></script>
  <script src="plugins/apexcharts/apexcharts.min.js"></script>

  <!-- Shared metrics + page init -->
  <script src="assets/pages/ssc-metrics.js"></script>
  <script>sscFinancialInit();</script>

  <script src="assets/js/app.js"></script>
  <!-- Firebase SDK -->
  <script src="assets/js/firebase-config.js"></script>
</body>
</html>